from django.shortcuts import render, HttpResponse, redirect
import requests
import json

from django.forms import inlineformset_factory
from django.contrib.auth.forms import UserCreationForm

from django.contrib.auth import authenticate, login, logout

from django.contrib import messages

from django.contrib.auth.decorators import login_required
from .models import *
#from newsapi import NewsApiClient
#import covidstats


# Create your models here.
def startPage(request):
    return render(request, 'home/start.html')

@login_required(login_url='login')
def homePage(request):
    #vietnam_case =  covidstats.Coronavirus().get_stats("Vietnam")
    vietnam_case = [{'Country': 'Vietnam', 'TotalCases': '1,181,337', 'NewCases': '', 'TotalDeaths': '24,544 ', 'NewDeaths': '', 'TotalRecovered': '955,256', 'ActiveCases': '603,234', 'CriticalCases': '201,537'}]

    vietnam_totalcase = vietnam_case[0]['TotalCases']
    vietnam_deaths = vietnam_case[0]['TotalDeaths']
    vietnam_recovered = vietnam_case[0]['TotalRecovered']
    vietnam_active = vietnam_case[0]['ActiveCases']

    #newsapi = NewsApiClient(api_key='e6702efb133e48418f78ea26f4620e20') 

    # top_headlines = newsapi.get_top_headlines(q='covid',
    #                                       category='business',
    #                                       language='en',
    #                                       country='us')
    
    #data = top_headlines['articles']
    data = [{'source': {'id': None, 'name': 'KSL.com'}, 'author': 'Manas Mishra, Reuters, Michael Erman, Reuters', 'title': "Merck's COVID-19 pill significantly less effective in new analysis - KSL.com", 'description': 'Merck & Co said on Friday updated data from its study of its experimental COVID-19 pill showed the drug was significantly less effective in cutting hospitalizations and deaths than previously reported.', 'url': 'https://www.ksl.com/article/50292040/mercks-covid-19-pill-significantly-less-effective-in-new-analysis', 'urlToImage': 'https://img.ksl.com/slc/2852/285201/28520112.JPG?filter=kslv2/responsive_story_lg', 'publishedAt': '2021-11-27T02:24:46Z', 'content': 'Estimated read time: 3-4 minutes\r\nWASHINGTON Merck &amp; Co said on Friday updated data from its study of its experimental COVID-19 pill showed the drug was significantly less effective in cutting ho… [+3539 chars]'}, {'source': {'id': 'cbs-news', 'name': 'CBS News'}, 'author': 'Irina Irina', 'title': 'Dow plunges 2.5% as new COVID-19 variant stokes financial fears - CBS News', 'description': 'Concerns about the new variant are spurring a stock sell-off, as some European countries impose flight restrictions.', 'url': 'https://www.cbsnews.com/news/dow-jones-drops-covid-19-variant-stock-market/', 'urlToImage': 'https://cbsnews1.cbsistatic.com/hub/i/r/2021/11/26/1d079361-6eb0-43ec-ab03-6ba13fa57861/thumbnail/1200x630/f1771c1d1fd8877028a76b6b8d7fdef6/wall-street-gettyimages-1236441835.jpg', 'publishedAt': '2021-11-27T01:50:00Z', 'content': 'Stocks fell precipitously on Friday, rattled by news of a new coronavirus variant that led several countries to impose travel restrictions.\r\nThe Dow, which plunged more than 1,000 points midday, clos… [+3391 chars]'}, {'source': {'id': None, 'name': "Barron's"}, 'author': 'Randall W. Forsyth', 'title': "Yes, Black Friday Was Painful for Investors, but You Shouldn’t Panic - Barron's", 'description': 'Emergence of a new Covid variant helps trigger year’s worst day on Wall Street, but nations are better prepared to handle the threat than they were at start of pandemic.', 'url': 'https://www.barrons.com/articles/yes-black-friday-was-painful-for-investors-but-you-shouldnt-panic-51637973212', 'urlToImage': 'https://images.barrons.com/im-442111/social', 'publishedAt': '2021-11-27T00:33:00Z', 'content': 'Black Friday is known for big markdowns, but not like these. Stocks, commodities, and bond yields plunged on Friday after news of a new coronavirus variant from South Africa, which was feared to set … [+333 chars]'}, {'source': {'id': None, 'name': 'Tampa Bay Times'}, 'author': 'Ian Hodgson', 'title': 'How bad are COVID booster side effects? And answers to other vaccine booster questions. - Tampa Bay Times', 'description': 'The extra dose can help wake up your immune system, but it might come with side effects.', 'url': 'https://www.tampabay.com/news/health/2021/11/26/how-bad-are-covid-booster-side-effects-and-answers-to-other-vaccine-booster-questions/', 'urlToImage': 'https://www.tampabay.com/resizer/hgfGLnS_NtEf7jdXJX62a694nUA=/800x450/smart/cloudfront-us-east-1.images.arcpublishing.com/tbt/Q7DA5PHZKVE3LH24L3VYMJR3C4.jpg', 'publishedAt': '2021-11-26T21:04:51Z', 'content': 'Its been just over a week since U.S. health officials approved COVID-19 booster shots for people 18 and over. Nearly 2.3 million Floridians have received boosters, and approximately 5.7 million more … [+5786 chars]'}, {'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Anna Hirtenstein', 'title': 'Covid-19 Variant Upends Investor Bets on Rate Increases - The Wall Street Journal', 'description': 'Bond yields slide and investors quickly adjust how swiftly they expect the Fed to raise interest rates', 'url': 'https://www.wsj.com/articles/covid-19-variant-upends-investor-bets-on-rate-increases-11637937935', 'urlToImage': 'https://images.wsj.net/im-441680/social', 'publishedAt': '2021-11-26T21:04:00Z', 'content': 'Investors piled into government bonds and quickly recalibrated their expectations for interest-rate increases in response to the new Covid-19 variant first identified in South Africa.\r\nThe yield on t… [+250 chars]'}, {'source': {'id': None, 'name': 'MarketWatch'}, 'author': 'Claudia Assis', 'title': "Moderna to 'rapidly advance' omicron-specific COVID-19 booster candidate - MarketWatch", 'description': 'Moderna Inc. undefined said Friday it will "rapidly advance" an omicron-specific COVID-19 booster vaccine candidate and continue to work on booster...', 'url': 'https://www.marketwatch.com/story/moderna-to-rapidly-advance-omicron-specific-covid-19-booster-candidate-2021-11-26', 'urlToImage': 'https://s.wsj.net/public/resources/MWimages/MW-GP644_MicroS_ZG_20180906154215.jpg', 'publishedAt': '2021-11-26T20:56:00Z', 'content': 'Moderna Inc. \r\n MRNA,\r\n +20.57%\r\nsaid Friday it will "rapidly advance" an omicron-specific COVID-19 booster vaccine candidate and continue to work on booster candidates designed to anticipate mutatio… [+624 chars]'}, {'source': {'id': None, 'name': 'Fox Business'}, 'author': 'Megan Henney', 'title': "Wall Street's fear gauge spikes amid fears over new COVID-19 variant - Fox Business", 'description': "Wall Street's fear gauge spiked on Friday as a new, highly-mutated COVID-19 variant detected in South Africa prompted some countries to reimpose travel bans, reigniting fears that a resurgent virus could derail the global economy's recovery.", 'url': 'https://www.foxbusiness.com/markets/wall-streets-fear-gauge-covid-19-variant', 'urlToImage': 'https://a57.foxnews.com/static.foxbusiness.com/foxbusiness.com/content/uploads/2020/11/0/0/Wall-Street.jpg?ve=1&tl=1', 'publishedAt': '2021-11-26T20:08:22Z', 'content': "Wall Street's fear gauge spiked on Friday as a new, highly-mutated COVID-19 variant\r\n detected in South Africa prompted some countries to reimpose travel bans, reigniting fears that a resurgent virus… [+3065 chars]"}, {'source': {'id': None, 'name': 'OilPrice.com'}, 'author': 'Tom Kool', 'title': "Oil Prices Crash As Covid Does What Biden Couldn't - OilPrice.com", 'description': "Renewed Covid fears have managed to do what Biden couldn't, sending oil prices crashing as a new wave of demand destruction looms.", 'url': 'https://oilprice.com/Energy/Energy-General/Oil-Prices-Crash-As-Covid-Does-What-Biden-Couldnt.html', 'urlToImage': 'https://d32r1sh890xpii.cloudfront.net/article/718x300/2021-11-26_gi02v3brg5.jpg', 'publishedAt': '2021-11-26T20:00:00Z', 'content': "Europe's first cold spell of…\r\nEl Salvador President Nayib Bukele…\r\nSpace waste is a growing…\r\nBy Tom Kool - Nov 26, 2021, 2:00 PM CSTRenewed Covid fears have managed to do what Biden couldn't, sendi… [+5066 chars]"}, {'source': {'id': None, 'name': 'Motley Fool'}, 'author': 'Bram Berkowitz', 'title': 'Why Shares of Wells Fargo, Citigroup, Bank of America, and JPMorgan Chase Are Falling Today - Motley Fool', 'description': 'Major U.S. large-cap bank stocks struggled along with the broader market, which is reeling from new COVID-related fears and higher inflation.', 'url': 'https://www.fool.com/investing/2021/11/26/why-shares-of-wells-fargo-citigroup-bank-of-americ/', 'urlToImage': 'https://g.foolcdn.com/editorial/images/654851/generic-downward-5.jpg', 'publishedAt': '2021-11-26T19:27:47Z', 'content': 'What happened\r\nShares of all the major U.S. bank stocks struggled today, along with the Dow Jones Industrial Average, which at one point fell 1,000 points on this shortened day of trading -- the wors… [+3483 chars]'}, {'source': {'id': None, 'name': 'Fox Business'}, 'author': 'Julia Musto', 'title': 'Omicron COVID-19 variant: Pfizer, BioNTech say vaccine could be reworked in 100 days to counter strain - Fox Business', 'description': 'Pfizer and BioNTech said Friday that a COVID-19 vaccine could be developed and produced within 100 days to counter a "vaccine-escape" variant like B.1.1.529.', 'url': 'https://www.foxbusiness.com/markets/covid-omicron-variant-pfizer-biontech-vaccine-reworked-100-days', 'urlToImage': 'https://a57.foxnews.com/static.foxbusiness.com/foxbusiness.com/content/uploads/2021/11/0/0/pfizer-vaccine.gif?ve=1&tl=1', 'publishedAt': '2021-11-26T18:54:04Z', 'content': 'Pfizer and BioNTech said Friday that a COVID-19 vaccine could be tweaked and produced within 100 days to counter a "vaccine-escape" variant.\r\nThe World Health Organization identified the B.1.1.529 st… [+5740 chars]'}, {'source': {'id': 'abc-news', 'name': 'ABC News'}, 'author': 'Julia Jacobo', 'title': 'Dow sinks more than 900 points on concerns over South Africa COVID-19 variant - ABC News', 'description': '', 'url': 'https://abcnews.go.com/Business/dow-sinks-900-points-concerns-south-africa-covid/story?id=81406349', 'urlToImage': 'https://s.abcnews.com/images/US/nyse-ap-ml-211126_1637942945647_hpMain_16x9_992.jpg', 'publishedAt': '2021-11-26T18:18:19Z', 'content': 'The Dow Jones Industrial Average sank more than 900 points on Friday over concerns about the spread of the new COVID-19 variant detected in South Africa.\r\nAnxiety among investors grew as countries ra… [+1394 chars]'}, {'source': {'id': None, 'name': 'Yahoo Entertainment'}, 'author': 'Ines Ferré', 'title': 'Expedia, Airbnb, and other travel stocks drop amid discovery of new COVID-19 variant, market selloff - Yahoo Finance', 'description': 'Travel platform Expedia (EXPE) and home sharing site Airbnb (ABNB) are some of the stocks swept into the travel sell-off on Friday over concerns of a variant...', 'url': 'https://finance.yahoo.com/news/market-selloff-expedia-airbnb-both-drop-amid-discovery-of-new-covid-19-variant-172137430.html', 'urlToImage': 'https://s.yimg.com/ny/api/res/1.2/CFTs62XXGjn9gCjjFrl3xw--/YXBwaWQ9aGlnaGxhbmRlcjt3PTEyMDA7aD02MzU-/https://s.yimg.com/os/creatr-uploaded-images/2021-11/e660f7a0-4ee3-11ec-bb6f-17d70633ab05', 'publishedAt': '2021-11-26T18:15:48Z', 'content': 'Travel platform Expedia (EXPE) and home sharing site Airbnb (ABNB) are two of the stocks swept into the market sell-off on Friday over concerns of a COVID variant first detected in southern Africa.\r\n… [+1406 chars]'}, {'source': {'id': None, 'name': "Barron's"}, 'author': 'Joe Woelfel', 'title': "Zoom, Peloton and Moderna Stocks Surge. Why the Stay-at-Home Trade Is Back. - Barron's", 'description': 'Fears over a new, heavily mutated variant of Covid-19 sink stock markets Friday.', 'url': 'https://www.barrons.com/articles/stay-at-home-stocks-zoom-peloton-moderna-51637926340', 'urlToImage': 'https://images.barrons.com/im-375097/social', 'publishedAt': '2021-11-26T18:06:00Z', 'content': 'Shares of stay-at-home stocks such as Zoom Video Communications and vaccine makers like Moderna closed sharply Friday\xa0as concerns over a new variant of Covid-19 rocked global stock markets.\r\nZoom Vid… [+182 chars]'}, {'source': {'id': None, 'name': 'Cbslocal.com'}, 'author': 'WCCO-TV Staff', 'title': 'COVID In Minnesota: State Tallies More Than 10,000 Reinfections Since Pandemic’s Start - WCCO | CBS Minnesota', 'description': 'As post-Thanksgiving crowds hit stores for Black Friday, Small Business Saturday and Cyber Monday deals, health officials in Minnesota report 4,131 new cases of COVID-19 and 56 deaths.', 'url': 'https://minnesota.cbslocal.com/2021/11/26/covid-in-minnesota-state-tallies-more-than-10000-reinfections-since-pandemics-start/', 'urlToImage': 'https://minnesota.cbslocal.com/wp-content/uploads/sites/15909630/2021/11/snapshot-3.jpg?w=1500', 'publishedAt': '2021-11-26T17:49:00Z', 'content': 'MINNEAPOLIS (WCCO) As post-Thanksgiving crowds hit stores for Black Friday, Small Business Saturday and Cyber Monday deals, health officials in Minnesota report 4,131 new cases of COVID-19 and 56 dea… [+1846 chars]'}, {'source': {'id': None, 'name': "Investor's Business Daily"}, 'author': "Investor's Business Daily", 'title': "Pfizer Stock Breaks Out As New Variant Threat Looms Over Covid Shots - Investor's Business Daily", 'description': 'The new variant contains a number of mutations to the spike protein.', 'url': 'https://www.investors.com/research/ibd-stock-of-the-day/pfizer-stock-breaks-out-as-new-variant-threat-looms-over-covid-shots/', 'urlToImage': 'https://www.investors.com/wp-content/uploads/2021/11/sotd-for-11-26-2021-desktop-1.png', 'publishedAt': '2021-11-26T17:06:00Z', 'content': 'Pfizer (PFE) is the IBD Stock Of The Day as scientists grapple with a new variant that could undo Covid vaccines. In response, Pfizer stock broke definitively into a buy zone.\r\nXThe new variant calle… [+3456 chars]'}, {'source': {'id': 'usa-today', 'name': 'USA Today'}, 'author': 'Celina Tebor, USA TODAY', 'title': 'Troubling COVID variant on the rise in South Africa; millions of Americans return to holiday travel: Latest updates - USA TODAY', 'description': 'Home COVID-19 tests during the Thanksgiving holiday raise challenges for public health officials. More live updates.', 'url': 'https://www.usatoday.com/story/news/health/2021/11/25/covid-thanksgiving-travel-vaccinations-tests-travel/8755086002/', 'urlToImage': 'https://www.gannett-cdn.com/presto/2021/11/25/USAT/f71fb464-2781-4de7-a212-3b94ff541407-AP_Holiday_Travel_Massachusetts.jpg?auto=webp&crop=4499,2531,x0,y103&format=pjpg&width=1200', 'publishedAt': '2021-11-25T20:26:15Z', 'content': 'Thousands of people traveling for the holidays this week will first test\xa0themselves for COVID-19 without a doctor, lab or any medical oversight.\r\nWhile quick\xa0home tests are hailed as a major convenie… [+7948 chars]'}, {'source': {'id': None, 'name': 'Theepochtimes.com'}, 'author': None, 'title': 'Unionized Workers Won’t Have to Get COVID-19 Vaccine, Automakers Decide - The Epoch Times', 'description': 'A major union and three large automakers announced an agreement this week that includes not mandating COVID-19 vaccination. ...', 'url': 'https://www.theepochtimes.com/unionized-workers-wont-have-to-get-covid-19-vaccine-automakers-decide_4123902.html', 'urlToImage': 'https://img.theepochtimes.com/assets/uploads/2021/11/25/gm-factory-1200x800.jpg', 'publishedAt': '2021-11-25T11:45:27Z', 'content': 'A major union and three large automakers announced an agreement this week that includes not mandating COVID-19 vaccination.\r\nFord, General Motors, and Stellantis are asking members of the United Auto… [+2720 chars]'}]
    desc = []
    news = []
    img = []
    url = []

    for i in range(len(data)):
        news.append(data[i]['title'])
        desc.append(data[i]['description'])
        img.append(data[i]['urlToImage'])
        url.append(data[i]['url'])
    mylist = zip(news, desc, img, url)

    context = {
        'vietnam_totalcase': vietnam_totalcase,
        'vietnam_deaths': vietnam_deaths,
        'vietnam_recovered': vietnam_recovered,
        'vietnam_active': vietnam_active,
        'mylist': mylist,
    }

    return render(request, 'home/home.html', context)
